

{% extends 'home/base.html.twig' %}

{% block body %}

  {# include necessary scripts and styles #}
  <script src="{{ asset('assets/js/cards.js') }}"></script>
<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.15.3/css/all.css" integrity="sha384-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" crossorigin="anonymous">
  <link rel="stylesheet" href="{{ asset('assets/css/cards.css') }}">
   <script src="https://js.stripe.com/v3/"></script>
  {# render the list of products #}
 <div class="wrapper">
  <form action="{{ path('app_market_index') }}" method="get" class="search-filter-form">

   
    <div class="search-filter-container">
     <div class="search-container">
      <input type="text" placeholder="Search Products..." name="search" value="{{ app.request.query.get('search') }}">
      <button type="submit"><i class="fa fa-search"></i></button>
    </div>
      <div class="filter-container">
        <div class="filter">
          <h5>Category</h5>
          <ul>
            <li>
              <input type="checkbox" id="category1" name="category[]" value="Avatars" {{ 'Avatars' in app.request.query.get('category', []) ? 'checked' : '' }}>
              <label for="category1">Avatars</label>
            </li>
            <li>
              <input type="checkbox" id="category2" name="category[]" value="Mascott" {{ 'Mascott' in app.request.query.get('category', []) ? 'checked' : '' }}>
              <label for="category2">Mascott</label>
            </li>
            <li>
              <input type="checkbox" id="category3" name="category[]" value="Wallpaper" {{ 'Wallpaper' in app.request.query.get('category', []) ? 'checked' : '' }}>
              <label for="category3">Wallpaper</label>
            </li>
            <li>
              <input type="checkbox" id="category4" name="category[]" value="Backgrounds" {{ 'Backgrounds' in app.request.query.get('category', []) ? 'checked' : '' }}>
              <label for="category4">Backgrounds</label>
            </li>
             <li>
              <input type="checkbox" id="category5" name="category[]" value="Graphic Design" {{ 'Graphic Design' in app.request.query.get('category', []) ? 'checked' : '' }}>
              <label for="category5">Graphic Design</label>
            </li>
          </ul>
        </div>
        <div class="filter">
          <h5>Price</h5>
          <ul>
            <li>
              <input type="checkbox" id="price1" name="price[]" value="price1" {{ 'price1' in app.request.query.get('price', []) ? 'checked' : '' }}>
              <label for="price1">0dt - 5dt</label>
            </li>
            <li>
              <input type="checkbox" id="price2" name="price[]" value="price2" {{ 'price2' in app.request.query.get('price', []) ? 'checked' : '' }}>
              <label for="price2">5dt - 15dt</label>
            </li>
            <li>
              <input type="checkbox" id="price3" name="price[]" value="price3" {{ 'price3' in app.request.query.get('price', []) ? 'checked' : '' }}>
              <label for="price3">>15dt</label>
            </li>
          </ul>
        </div>
      </div>
    </div>
   
  </form>
     <div class="product-container">

        {% for produit in produits %}
          <div class="product">
            <div class="product-img">
              <img src="{{ asset('images/products/' ~ produit.image) }}" alt="{{ produit.nom }}">
            </div>
            <div class="product-info">
              <div class="product-text">
                <h1>{{ produit.nom }}</h1>
                <h6>{{ produit.categorie }}</h6>
                <div class="seller-info">
                  <div>
                    <small>{{ produit.description }}</small>
                  </div>
                  <small>By {{ produit.vendeur }} {{ produit.vendeur.prenom }}</small>
                </div>
              </div>
              <div class="product-price-btn">
      {% set amount = produit.prix * 100 %}

<button id="buy-btn" class="buy-btn">
  <a href="{{ path('pay', {'idproduit': produit.idproduit}) }}">
  
    <i class="fa fa-shopping-cart"></i>
  </a>
  {{ produit.prix }} dt
</button>

                <button class="contact-seller-btn" data-popup="contact-seller-popup">Contact Seller</button>
                <div class="contact-seller-popup">
                  <p>Phone: {{ produit.vendeur.numtel }}</p>
                  <p>Email: {{ produit.vendeur.email }}</p>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
        

      </div>
     
</div>
 <div class="knp-pagination">
    {{ knp_pagination_render(produits) }}
</div>
  {# handle click events of buttons to show or hide pop-ups #}
  <script>
    const contactSellerBtns = document.querySelectorAll('.contact-seller-btn');
    const contactSellerPopups = document.querySelectorAll('.contact-seller-popup');

    for (let i = 0; i < contactSellerBtns.length; i++) {
      contactSellerBtns[i].addEventListener('click', function(e) {
        e.stopPropagation();
        contactSellerPopups[i].classList.toggle('show');
      });
    }

    window.addEventListener('click', function() {
      for (let i = 0; i < contactSellerPopups.length; i++) {
        if (contactSellerPopups[i].classList.contains('show')) {
          contactSellerPopups[i].classList.remove('show');
        }
      }
    });
  </script>
<script src="https://js.stripe.com/v3/"></script>

<script>
const stripe = Stripe('your-stripe-public-key');

document.getElementById('buy-btn').addEventListener('click', function(event) {
  // Prevent the default behavior of the button click
  event.preventDefault();

  // Get the product details and price from the HTML
  const productName = 'Product Name'; // Replace with your product name
  const productPrice = document.querySelector('.buy-btn p').textContent;

  // Send an AJAX request to your server with the product details and price
  const xhr = new XMLHttpRequest();
  xhr.open('POST', '/pay');
  xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  xhr.onload = function() {
    if (xhr.status === 200) {
      // Redirect the user to Stripe Checkout
      stripe.redirectToCheckout({
        sessionId: xhr.response.sessionId
      });
    } else {
      console.error(xhr.responseText);
    }
  };
  xhr.send(encodeURI('productName=' + productName + '&productPrice=' + productPrice));
});
</script>

{% endblock %}
{% block footer %}
  
{% endblock %}